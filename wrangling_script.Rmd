---
title: "data_cleaning"
author: "Gordon Blasco"
date: "February 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(scales)
library(sf)
library(leaflet)

# Read in data
gulls <- read_csv("seagulls_small.csv")
```


```{r}
# Make an even smaller test dataset

gulls_tiny <- gulls %>% 
  filter(
    county == 'Santa Barbara' |
      county == 'Orange' |
      county == 'Los Angeles'
  ) 

write_csv(gulls_tiny, "seagulls_tiny.csv")
```


```{r}
gulls_final <- gulls %>% 
  filter(
    county == 'Santa Barbara' &
      common_name != 'Western Gull'
  )  %>% 
  group_by(common_name) %>% 
  summarize(
    n = sum(observation_count)
  ) %>% 
  mutate(
    total = sum(n),
    prop = n / total
  ) %>% 
  arrange(-prop) %>% 
  mutate(common_name = factor(common_name, levels = common_name))

prop_plot <- ggplot(gulls_final, aes(x = common_name, y = prop)) +
  geom_col() +
  scale_x_discrete(expand = c(0,0)) +
  scale_y_continuous(labels=percent_format(),
                     expand = c(0,0)) +
  theme_bw() +
  coord_flip()

prop_plot
```


####MAP####

```{r}
#demo(nc, ask = FALSE, echo = FALSE)
#plot(st_geometry(nc))



m <- leaflet() %>%
  addTiles() %>%  
  setView(-119.4179, 36.7783, zoom = 5) %>%
  addMarkers(lng=-72.690940, lat=41.651426, popup="<b>Hello</b><br><a href='http://www.trendct.org'>-TrendCT.org</a>")
m 
```

```{r}
m <- leaflet(gulls) %>% 
  addTiles('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', attribution='Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>') %>%
    setView(-119.4179, 36.7783, zoom = 5) %>% 
    addCircles(~longitude, ~latitude, popup=gulls$common_name, weight = 3, radius=40, 
                   color="#ffa500", stroke = TRUE, fillOpacity = 0.8) %>% 
    addLegend("bottomright", colors= "#ffa500", labels="GULLS!", title="In CALI")
m
```



